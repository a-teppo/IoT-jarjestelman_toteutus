<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <style>
      .container {
        height: 500px;
        width: 90vw;
        display: inline-block;
      }
    </style>

    <div class="container">
      <canvas id="temperatureChart"></canvas>
      <canvas id="humidityChart"></canvas>
      <canvas id="pressureChart"></canvas>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    <script>
      function getTemps() {
        let tempArr = [];

        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
          //console.log("return",this.readyState,this.status);
          if (this.readyState == 4 && this.status == 200) {
            // console.log("response", this.responseText)

            //tempArr  = this.response.temperature;
            //console.log(response)
            tempArr = JSON.parse(this.responseText);

            function throwData(arr, name) {
              let temp = [];
              for (i in arr) {
                temp.push(arr[i]);
              }

              addData(temp, `${name}`);
            }

            throwData(tempArr.temperature, 'temperature');
            throwData(tempArr.humidity, 'humidity');
            throwData(tempArr.pressure, 'pressure');

            //       let temperature = [];
            //       for (i in tempArr.temperature) {
            //     temperature.push(tempArr.temperature[i]);
            //   }

            //   let humidity = [];
            //       for (i in tempArr.humidity) {
            //     humidity.push(tempArr.humidity[i]);

            // }
            // let pressure = [];
            //       for (i in tempArr.pressure) {
            //         pressure.push(tempArr.pressure[i]);
            //   }

            // addData(temperature, "temperature");
            // addData(humidity, "humidity");
            // addData(pressure, "pressure");
          }
        };
        xmlhttp.open(
          "GET",
          "https://cors-anywhere.herokuapp.com/51.83.73.200/iot/dbdata.php",
          true
        );
        xmlhttp.send();
      }

      getTemps();

      function addData(temp, name) {
        var ctx = document.getElementById(`${name}Chart`).getContext("2d");
        var chart = new Chart(ctx, {
          // The type of chart we want to create
          type: "line",

          // The data for our dataset
          data: {
            //labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
            datasets: [
              {
                label: `${name}`,
                backgroundColor: "rgb(255, 255, 255.0)",
                borderColor: "rgb(255, 99, 132)",
                data: []
              }
            ]
          },

          // Configuration options go here
          options: {
            maintainAspectRatio: false,
            scales: {
              xAxes: [
                {
                  type: "time",
                  distribution: "series",
                  time: {
                    unit: "minute",
                    displayFormats: {
                      hour: "MMM DD",
                      day: "MMM DD"
                    }
                  }
                }
              ]
            }
          }
        });

        for (i in temp) {
          console.log(temp[i].Date, temp[i].SensorValue);
          chart.data.datasets[0].data.push({
            x: temp[i].Date,
            y: temp[i].SensorValue
          });
        }

        chart.update();
      }
    </script>
  </body>
</html>
